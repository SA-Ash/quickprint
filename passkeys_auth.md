# Passkeys (WebAuthn) — In-Depth Guide for Web Applications

## TL;DR













UUSMS delivery failures
- Cost and vendor lock-in

Passkeys solve:
- ❌ Passwords
- ❌ OTPs
- ❌ Phishing
- ❌ Shared secrets

They **do not** prove real-world identity.
They prove **cryptographic continuity**.

---

## 2. What a Passkey Actually Is (No Marketing)

A passkey is:
- A **public/private key pair**
- Generated by the **user’s device**
- Stored in **hardware-backed secure storage**

| Component | Where it lives |
|---------|----------------|
Private key | User device (non-exportable) |
Public key | Your server |
Biometric / PIN | Local unlock only |

> Biometrics are **never sent to your server**.

---

## 3. Core Mental Model

> **Passkeys authenticate the device + user presence, not the human identity.**

Think:
- OTP → “You have the SIM”
- Password → “You know a secret”
- Passkey → “You are the same actor as before”

---

## 4. Underlying Standard

Passkeys are built on:
- **WebAuthn**
- **FIDO2**

These are:
- W3C + FIDO Alliance standards
- Supported by Chrome, Safari, Firefox, Edge
- Backed by Apple, Google, Microsoft

No vendor lock-in.

---

## 5. High-Level Architecture

Browser
↓ (WebAuthn API)
Operating System
↓ (Secure Enclave / TPM / Keystore)
Cryptographic Key
↓ (Signed Challenge)
Your Backend


Your server **never sees**:
- Private keys
- Biometrics
- Device secrets

---

## 6. Registration Flow (Create Passkey)

### Step-by-step

1. User clicks **“Create passkey”**
2. Server generates:
   - Random challenge
   - User ID (stable UUID)
3. Browser asks OS to create credential
4. OS:
   - Generates key pair
   - Stores private key securely
5. Browser sends public key + metadata to server
6. Server stores public key

### What the server stores
- Credential ID
- Public key
- Signature counter
- User ID

---

## 7. Authentication Flow (Login)

### Step-by-step

1. User clicks **“Sign in with passkey”**
2. Server sends a challenge
3. OS prompts for:
   - Biometric **or**
   - Device PIN/password
4. Private key signs challenge
5. Server verifies signature
6. Login success

---

## 8. What Happens on a PC (Critical Detail)

### Case A: PC with biometrics
- Windows Hello / Touch ID
- Uses fingerprint or face

### Case B: PC without biometrics
Fallback is **mandatory**:
- Windows → account PIN/password
- macOS → system password
- Linux → user password / keyring

> There is **no such thing** as “key-only login” without user presence.

---

## 9. Is the Key Ever Exposed?

No.

- Private key is **non-exportable**
- JavaScript cannot read it
- Browser cannot read it
- Malware cannot extract it remotely

Only signing is allowed.

---

## 10. Cross-Device Login (PC ↔ Phone)

Built-in, free, automatic.

Flow:
1. User opens login page on PC
2. Clicks “Use passkey”
3. QR code appears
4. User scans with phone
5. Phone signs challenge
6. PC session is authenticated

You don’t implement QR logic — browsers do.

---

## 11. Shared Devices & Public PCs

This is the **main risk scenario**.

Best practices:
- Never auto-register passkeys
- Require explicit user action
- Warn on:
  - Incognito mode
  - No screen lock
  - Public computers

Rule:
> Passkeys are for **personal devices only**.

---

## 12. Can Passkeys Be Shared or Aliased?

Yes — **locally**.

If two people:
- Share the same device
- Share the same OS account

Then both can authenticate.

This is **out of scope** for web auth.
No system can prevent this.

---

## 13. Security Guarantees

| Threat | Passkeys |
|------|---------|
Phishing | ❌ Impossible |
Credential stuffing | ❌ Impossible |
SIM swap | ❌ Irrelevant |
Replay attacks | ❌ Blocked |
Database leaks | ✅ Safe |
Man-in-the-middle | ❌ Blocked |

---

## 14. What Passkeys Do NOT Solve

- Real-world identity verification
- Device theft with unlocked access
- Shared family devices
- Legal identity binding

Passkeys are **authentication**, not **KYC**.

---

## 15. Recovery (Absolutely Required)

You must provide recovery options.

Recommended:
- Multiple passkeys per account
- Recovery codes (one-time download)
- Email magic link (SMTP only)

Never rely on:
- A single passkey
- A single device

---

## 16. Minimal Data Model

```text
User
- id (UUID)
- created_at

Credential
- id (credentialId)
- user_id
- public_key
- sign_count
- created_at


UU



























































































































































































































































































































































































































